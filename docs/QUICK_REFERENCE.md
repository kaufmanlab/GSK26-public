# GSK26-public Quick Reference

This summary was generated by a Claude Code instance prompted to summarize code into an easily digestible format without changing it in any way.

## Directory Structure
```
GSK26-public/
├── main/fig1-6/    Figure generation scripts + analysis + plot functions
├── preproc/        Data loading & event-locking pipeline
└── utils/          Shared utilities (plotting, math, data)
```

## main/fig1/ — Motor Behavior & Kinematics
| File | Type | Summary |
|------|------|---------|
| `fig1_main.m` | Script | Generates Fig 1 panels A-I: skeleton poses, 3D trajectories, event time distributions, opto inactivation |
| `plots/plotTrajectories.m` | `plotTrajectories(kinematics, plotParams)` | 3D reach trajectories for L/R trials with spout and event markers |
| `plots/plotSkeleton.m` | `plotSkeleton(posXYZ, plotParams, view)` | Sequence of skeleton poses offset in X |
| `plots/plotOptoHists.m` | `plotOptoHists(data)` | Histogram of contact times: normal vs opto trials |
| `plots/plotNContactsDistributions.m` | `plotNContactsDistributions(eventInfo)` | Bar chart of spout contact counts within 1s |
| `plots/plotEventTimeDistributions.m` | `plotEventTimeDistributions(eventInfo, eventName, yLim, zeroLabel)` | Box plots of event timing across mice, L vs R |
| `plots/plotOptoTrajectories.m` | `plotOptoTrajectories(kinematics, plotParams)` | 3D fingertip trajectories: opto (cyan) vs control (gray) |

## main/fig2/ — Paw Aperture Kinematics
| File | Type | Summary |
|------|------|---------|
| `fig2_main.m` | Script | Generates Fig 2 panels A-E: aperture polygon, time series, event hists, trajectories, spreads |
| `analysis/apertureFeatures.m` | `kinematics = apertureFeatures(kinematics)` | Adds .collectBin/.extendBin/.maxZVelBin to kinematics struct |
| `plots/plotAperturePolygon.m` | `plotAperturePolygon(data, plotParams)` | Skeleton at lift/collect/extend with filled aperture polygon |
| `plots/plotApertureTimeSeries.m` | `plotApertureTimeSeries(data)` | Dual-axis plot: normalized aperture + Z velocity |
| `plots/plotApertureEventHists.m` | `plotApertureEventHists(kinematics)` | Histograms of collect/extend timing, L vs R |
| `plots/plotTrajectoryApertureEvents.m` | `plotTrajectoryApertureEvents(kinematics)` | 3D centroid trajectories with lift/collect/extend markers |
| `plots/plotApertureSpreads.m` | `plotApertureSpreads(kinematics, maxpeaks)` | Median +/- percentile aperture aligned to max Z velocity |

## main/fig3/ — Joint Angle Kinematics & Dimensionality
| File | Type | Summary |
|------|------|---------|
| `fig3_main.m` | Script | Generates Fig 3 panels A-E: Euler angle skeleton, joint time series, correlations, CV-PCA |
| `analysis/crossvalPCAYu.m` | `[best, lossTest, SEMs, lossTrain] = crossvalPCAYu(data, labels, maxDim, ...)` | Byron Yu's double-holdout CV-PCA for dimensionality selection |
| `analysis/jointKinematicsCVPCA.m` | `[lossTests, lossSEMs] = jointKinematicsCVPCA(kinematicsAll, maxDims, nLabels)` | CV-PCA on joint angles and velocities per mouse |
| `plots/plotSkeletonEulerAngles.m` | `plotSkeletonEulerAngles(data, tPt, plotParams, view)` | Skeleton with RGB coordinate frames at joints |
| `plots/plotJointAnglesVertical.m` | `plotJointAnglesVertical(kinematics, joints)` | Joint angle time series, L/R side-by-side, joints stacked |
| `plots/plotJointAngleCorr.m` | `plotJointAngleCorr(kinematicsAll, field)` | Correlation matrices of joint angles per mouse |
| `plots/plotJointKinematicsCVPCA.m` | `plotJointKinematicsCVPCA(lossTests)` | Paired dot-plot: best dimensionality angles vs velocities |
| `plots/plotJointKinematicsCVPCALoss.m` | `plotJointKinematicsCVPCALoss(lossTests, lossSEMs, mouseN, maxDims)` | CV-PCA loss curve with error bars for one mouse |

## main/fig4/ — Neural Recording Sites & Modulation
| File | Type | Summary |
|------|------|---------|
| `fig4_main.m` | Script | Generates Fig 4 panels A-D: FOVs on Allen CCF, ZETA scores, raster/PETH |
| `plots/plotFOVsAllenCCF.m` | `plotFOVsAllenCCF(locsM1, locsS1, rotations)` | FOV rectangles on Allen dorsal cortical map |
| `plots/plotZETAScores.m` | `plotZETAScores(modScores, thresh)` | Scatter of log10 ZETA p-values, colored by tuning |
| `plots/rasterPETH.m` | `rasterPETH(R, M, roi, eventName, preMs, postMs, clusField, sortField, ...)` | PETH with SEM + optional single-trial raster heatmap |

## main/fig5/ — Neural Decoding of Kinematics
| File | Type | Summary |
|------|------|---------|
| `fig5_main.m` | Script | Generates Fig 5 panels A-H: VE violins, joint reconstructions, 3D pose reconstructions, all-mice summary |
| `fig5_analysis.m` | Script | Runs 6 regression models x 2 neural types x 2 kinematic types |
| `fig5_supp1.m` | Script | Supp: smoothed-deconv angles + RADICaL velocities |
| `fig5_supp2.m` | Script | Supp: partial models + variance vs VE |
| `fig5_supp3.m` | Script | Supp: residual decoding + Wiener filters |
| `analysis/cvRegress.m` | `output = cvRegress(predictors, outcomes, nPart, nFolds, regType, ...)` | Core CV regression engine (k-fold x partitions, ridge/OLS) |
| `analysis/ridgeMML.m` | `[L, betas, fails] = ridgeMML(Y, X, recenter, L)` | Ridge regression with marginal maximum likelihood lambda |
| `analysis/decode.m` | `output = decode(kinematics, neurons, tBins, ROIs, kinField, neuField)` | Instantaneous neural-to-kinematic regression with PCA + CV ridge |
| `analysis/decodeWiener.m` | `output = decodeWiener(kinematics, neurons, tPts, ROIs, lags, ...)` | Lagged Wiener filter model (causal or acausal) |
| `analysis/baggedDecode.m` | `summary = baggedDecode(summary, field)` | Bagged reconstruction across CV folds + forward kinematics |
| `analysis/decodePartialD2S.m` | `output = decodePartialD2S(kinematics, neurons, tBins, ROIs, ...)` | Regression after removing distance-to-spout from joint angles |
| `analysis/decodePartialPrxDst.m` | `output = decodePartialPrxDst(kinematics, neurons, tBins, ROIs, ...)` | Regression after removing proximal-distal mutual correlations |
| `analysis/decodeResiduals.m` | `output = decodeResiduals(kinematics, neurons, tBins, ROIs, ...)` | Regression on trial-to-trial residuals, separate L/R |
| `analysis/pca4Regression.m` | `[data, V, ve] = pca4Regression(data, nPCs, rotate, denoise, meanSub)` | PCA dimensionality reduction for neural data |
| `analysis/forwardKinematics_PD_vAF.m` | `posXYZ = forwardKinematics_PD_vAF(posXYZ, jointAngles)` | Forward kinematics: 24 joint angles -> 3D marker positions |
| `analysis/inverseKinematics_PD_vAF.m` | `[angles, posN, nPIPs] = inverseKinematics_PD_vAF(posXYZ)` | Inverse kinematics: 3D markers -> 24 joint angles |
| `analysis/rodriguesRot.m` | `vrot = rodriguesRot(v, k, theta, angle_type)` | Rodrigues rotation of vector v around axis k |
| `analysis/loadDecode.m` | `[out, PD, D2S, Res, Wc, Wa] = loadDecode(path, mouse, sess, ...)` | Runs all 6 decoding models for one dataset |
| `analysis/loadDecodeAll.m` | `outputs = loadDecodeAll(path, datasets, kinField, neuField, ...)` | Loops loadDecode over all 5 mice |
| `plots/plotVE.m` | `plotVE(output, inverty)` | VE violins for 24 joints: proximal (magenta) vs distal (orange) |
| `plots/violin.m` | `violin(hA, Y, axLoc, color, alpha, mrkSz, ...)` | Single violin plot (KDE + scatter + median) |
| `plots/violins.m` | `violins(hA, vals, names, cmap, axvals, ax, alpha, ...)` | Multiple violin plots on one axis |
| `plots/jointsReconPlot.m` | `ylims = jointsReconPlot(output, joints, field, ylims)` | Joint angle time series with neural reconstructions overlaid |
| `plots/reconPosePlot.m` | `reconPosePlot(output, M, trialIdx, frames, offsets)` | 3D skeleton: original (grey) vs reconstructed (colored) |
| `plots/plotVEAll.m` | `plotVEAll(outputs, field, inverty)` | VE summary scatter for all 5 mice |
| `plots/plotVEvsVar.m` | `plotVEvsVar(outputs, field)` | Scatter: joint variance vs variance explained |

## main/fig6/ — Target Classification
| File | Type | Summary |
|------|------|---------|
| `fig6_main.m` | Script | Generates Fig 6 panels A-D: classifier projections, timing, RT correlation, cross-time |
| `fig6_analysis.m` | Script | Runs target, RT, cross-time, and partial classifiers |
| `fig6_supp1.m` | Script | Supp: classifier performance over time |
| `analysis/cvClassifier.m` | `output = cvClassifier(data, nFolds, nPart, type, reg)` | CV linear classifier (logistic/SVM) for binary classification |
| `analysis/stratify.m` | `[kept, dropped] = stratify(labels)` | Balances binary labels by downsampling |
| `analysis/projectClassifier.m` | `output = projectClassifier(output, data, method)` | Projects time series onto classifier dimension |
| `analysis/targetClassifier.m` | `output = targetClassifier(data, config)` | L/R target classifier with threshold crossing analysis |
| `analysis/targetPartialClassifier.m` | `output = targetPartialClassifier(data, kinematics, config)` | Target classifier after regressing out kinematics |
| `analysis/rtClassifier.m` | `output = rtClassifier(data, config)` | Pre/post-event classifier for reaction time prediction |
| `analysis/targetXTClassifier.m` | `outputs = targetXTClassifier(data, config)` | Cross-time generalization: train on epochs, test on all bins |
| `analysis/findSubsequences.m` | `[subseqs, lens] = findSubsequences(sequence)` | Finds contiguous runs of 1s in binary vector |
| `analysis/loadClassifierAll.m` | `outputs = loadClassifierAll(path, datasets, model)` | Loops classifier over all mice (M1 + S1) |
| `analysis/loadTargetClassifier.m` | `output = loadTargetClassifier(path, mouse, session)` | Loads cue-locked data, runs targetClassifier |
| `analysis/loadRTClassifier.m` | `output = loadRTClassifier(path, mouse, session)` | Loads lift-locked data, runs rtClassifier |
| `analysis/loadTargetXTClassifier.m` | `output = loadTargetXTClassifier(path, mouse, session)` | Loads cue-locked XT data, runs targetXTClassifier |
| `analysis/loadTargetPartialClassifier.m` | `output = loadTargetPartialClassifier(path, mouse, session)` | Loads cue-locked data + kinematics, runs targetPartialClassifier |
| `plots/plotTargetClassifierProj.m` | `plotTargetClassifierProj(output, field, plotCrosstimes)` | Single-trial projection traces (time vertical, choice horizontal) |
| `plots/plotTargetClassifierTimingAll.m` | `plotTargetClassifierTimingAll(output)` | Violin distributions of threshold crossing times, M1 vs S1 |
| `plots/plotRTClassifierCorrelationAll.m` | `plotRTClassifierCorrelationAll(outputs, eventName, method)` | Real vs decoded RT correlation, M1 vs S1 |
| `plots/plotTargetXTPerformanceAll.m` | `plotTargetXTPerformanceAll(outputs)` | Cross-temporal generalization heatmaps |
| `plots/plotTargetClassifierPerformanceAll.m` | `plotTargetClassifierPerformanceAll(outputs)` | Time-resolved classifier accuracy, grand-mean + per-mouse |

## preproc/ — Preprocessing & Data Loading
| File | Signature | Summary |
|------|-----------|---------|
| `eventLockKinematics.m` | `data = eventLockKinematics(R, M, eventName, tPts, ...)` | Lock 3D DLC kinematics to event; computes pos/vel/acc/joints/aperture |
| `multiEventLockKinematics.m` | `data = multiEventLockKinematics(R, M, eventNames, preT, postT, tBase, lags, ...)` | Lock kinematics to two events with variable interval + lags |
| `eventLockData.m` | `data = eventLockData(R, M, eventName, tPts, rois)` | Lock deconvolved calcium events with sub-frame alignment |
| `eventLockDataSmooth.m` | `data = eventLockDataSmooth(R, M, eventName, tPts, smoothSD, rois, field)` | eventLockData + Gaussian smoothing with edge padding |
| `eventLockRADICaL.m` | `neurons = eventLockRADICaL(neurons, R, tPts, tPtsRADICaL, field)` | Extract RADICaL rates for matching time bins |
| `lockNeural4Classifier.m` | `[neurons, config, M] = lockNeural4Classifier(R, M, config)` | Select top 100 modulated neurons + lock for classification |
| `loadLock4Decode.m` | `[kin, neurons, M, config] = loadLock4Decode(mouse, session, config)` | Full pipeline: load + lock kinematics + neural for decoding |
| `loadLock4Classifier.m` | `[neurons, M, config, kin] = loadLock4Classifier(mouse, session, config)` | Full pipeline: load + lock neural for classification |
| `loadLockSave.m` | Script | Batch processes 10 datasets into 4 locked file types |
| `loadEventTimes.m` | `eventInfo = loadEventTimes(datasets, dataPath)` | Extract behavioral timing metrics (RT, movement time, grasps) |
| `loadLockKinematicsAll.m` | `kinAll = loadLockKinematicsAll(datasets, dataPath)` | Batch load + single-event lock kinematics |
| `loadMultilockKinematicsAll.m` | `kinAll = loadMultilockKinematicsAll(datasets, dataPath)` | Batch load + dual-event lock kinematics + aperture features |
| `loadCombinedModscores.m` | `modScores = loadCombinedModscores(datasets, dataPath, eventName)` | Concatenate ZETA p-values across datasets |

## utils/ — Utility Functions
| File | Signature | Summary |
|------|-----------|---------|
| `loadData.m` | `[R, M, config] = loadData(mouse, session, prefix, suffix, folder, verbose)` | Central data loader: finds .mat file, loads R/M, adds joint metadata |
| `loadCombinedDataset.m` | `R = loadCombinedDataset(dataset, dataPath)` | Load + merge two sessions from same mouse |
| `gaussFilt1.m` | `x = gaussFilt1(x, sd, dim)` | 1D Gaussian filtering on any dimension (uses imgaussfilt) |
| `eucDists.m` | `dists = eucDists(X)` | Vectorized pairwise Euclidean distances between columns |
| `rotatePoints.m` | `rotated = rotatePoints(alignVec, data)` | 2D/3D point rotation via rotation matrices |
| `keepFields.m` | `sOut = keepFields(sIn, keepList)` | Retain only specified struct fields |
| `timeClus.m` | `[R, M] = timeClus(R, M, field)` | Median-split trials into fast/slow timing clusters (1-4) |
| `colormapHSV.m` | `cmap = colormapHSV(cmap, hue, sat, val)` | Adjust colormap hue/saturation/value in HSV space |
| `fig.m` | `[hF, tl] = fig(layout, position, color)` | Create figure with tiledlayout and consistent styling |
| `AxisMMC.m` | `params = AxisMMC(start, fin, params)` | Publication-quality custom axis (by M. Churchland) |
| `plotBox.m` | `plotbox(ax, data, axloc, color, alpha, bxw, lw, msize, plotY)` | Custom boxplot with median/IQR/whiskers/jittered data |
| `setXYLim.m` | `setXYLim(ax, setX, setY, spacers)` | Auto-fit axis limits to plotted data |
| `drawSkeleton.m` | `h = drawSkeleton(hA, data, config, h)` | Draw skeleton links in 3D (supports animation) |
| `drawMarkers.m` | `h = drawMarkers(hA, data, config, h)` | Draw body markers as colored 3D dots (supports animation) |
| `drawTrace.m` | `h = drawTrace(hA, data, config, h)` | Draw 3D trajectory traces (scatter/line/time-colored) |
| `drawFill.m` | `h = drawFill(hA, data, config, h)` | Draw filled 3D polygons between markers |
| `coordAxes.m` | `coordAxes(ax, origin, scale, fontSize, flips, letters)` | Draw 3D XYZ coordinate reference frame |
| `arrow3D.m` | `arrow3D(pos, delta, color, stemRatio)` | Draw 3D arrow (cylinder + cone) |
| `allenMapPolyCentered.m` | `allenMapPolyCentered(maps, bregma, side, fill, scale, hAx)` | Allen Brain Atlas dorsal map with polygons |
| `printFigs.m` | `printFigs(figNums, folder, format, titles, landscape)` | Batch export figures to PDF/JPEG/TIFF/EPS |
| `turbo.m` | `map = turbo(m)` | Turbo colormap (256-entry LUT) |
| `diverging_map.m` | `map = diverging_map(s, rgb1, rgb2)` | Perceptually uniform diverging colormap (Moreland algorithm) |
| `allenDorsalMap.mat` | Data | Allen Brain Atlas dorsal surface mapping |
